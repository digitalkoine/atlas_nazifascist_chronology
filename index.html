<html>
  <head>
    <meta charset='utf-8' />
      <title>Atlas of Nazi-Fascist Repression</title>
      <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
      <!--this invokes the leaflet basemap css repository-->
      <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" />
      <!--this invokes the leaflet basemap js repository-->
      <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.min.js"></script>

      <!--this invokes the opacity plugin to control the layers transparency through a slider-->
      <script src="./Leaflet.Control.Opacity.Master/dist/L.Control.Opacity.js"></script>
      <link href="./Leaflet.Control.Opacity.Master/dist/L.Control.Opacity.css" rel="stylesheet" />
      <script type="text/javascript" src="./Leaflet.Coordinates.Master/dist/Leaflet.Coordinates-0.1.5.min.js"></script>
	    <link rel="stylesheet" href="./Leaflet.Coordinates.Master/dist/Leaflet.Coordinates-0.1.5.css"/>

      <link rel="stylesheet" href="./Leaflet.markercluster-1.4.1/dist/MarkerCluster.Default.css"/>
      <link rel="stylesheet" href="./Leaflet.markercluster-1.4.1/dist/MarkerCluster.css"/>
      <script type="text/javascript" src="./Leaflet.markercluster-1.4.1/dist/leaflet.markercluster.js"></script>
      <script type="text/javascript" src="./Leaflet.markercluster-1.4.1/dist/leaflet.markercluster-src.js"></script>
      <script src="./Leaflet.Control.Opacity.Master/dist/L.Control.Opacity.js"></script>
      <!--this invokes the slider plugin that should control the appearing and disappering of points
      <script src="./leaflet-slider-master/dist/leaflet-slider.js"></script>
      <link rel="stylesheet" href="./leaflet-slider-master/dist/leaflet-slider.css">-->
      <!--this invokes the coordinates plugin, which tells you the coordinates on hovering mouse-->
      <script type="text/javascript" src="./leaflet-button-master/L.Control.Button.js"></script>


      <script type="text/javascript" src="./iso8601-js-period-master/iso8601.js"></script>
      <script type="text/javascript" src="https://cdn.rawgit.com/socib/Leaflet.TimeDimension/master/dist/leaflet.timedimension.min.js"></script>
      <link rel="stylesheet" href="https://cdn.rawgit.com/socib/Leaflet.TimeDimension/master/dist/leaflet.timedimension.control.min.css" />

      <script src="./italia1.json" type="text/javascript"></script>-->
      <script src="./italia2.json" type="text/javascript"></script>-->
      <script src="./italia3.json" type="text/javascript"></script>-->
      <script src="./italia4.json" type="text/javascript"></script>-->
      <script src="./italia5.json" type="text/javascript"></script>-->

      <script src="./vittimeTest2.geojson" type="text/javascript"></script>-->
      <!--this invokes the jQuery js repository, which has not been used yet-->
      <script src="http://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
      <link href="http://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css" rel="stylesheet" type="text/css" />
      <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
      <!-- the style is the css part: either tags, ids (#), or class (.) are styled in here, and called later on as divs-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/OverlappingMarkerSpiderfier-Leaflet/0.2.6/oms.min.js"></script>
      <link rel="stylesheet" href="./easy-button/easy-button.css">
      <script src="./easy-button/easy-button.js"></script>
      <style>
          body {
                margin: 0;
                padding: 0;
                font-family: 'Helvetica Neue', Helvetica, Arial, Sans-serif;
                }
          /* this set the size information of the id "map", the main map which appears in the webpage */
          #map {
                position: absolute;
                top: 0;
                bottom: 0;
                width: 100%;
                }
          /* h1 is the tag set later on */
          h1 {
              font-size: 20px;
              line-height: 30px;
              }

          h2 {
              font-size: 14px;
              line-height: 20px;
              margin-bottom: 10px;
              }

          a  {
              text-decoration: none;
              color: #2dc4b2;
              }

          .legend {
            line-height: 30px;
            color: #555;
              }
          .legend i {
            width: 18px;
            height: 18px;
            float: left;
            margin-right: 20px;
            opacity: 0.7;
              }

          .info {
              padding: 6px 15px;
              font: 14px/16px Arial, Helvetica, sans-serif;
              background: white;
              line-height: 20px;
              background: rgba(255,255,255,0.8);
              box-shadow: 0 0 15px rgba(0,0,0,0.2);
              border-radius: 5px;
          }
          ul {
          padding-left: 20px;
          }

          .disclaimer {
              padding: 6px 15px;
              font: 1vw Arial, Helvetica, sans-serif;
              background: white;
              line-height: 2vw;
              background: rgba(255,255,255,0.8);
              box-shadow: 0 0 15px rgba(0,0,0,0.2);
              border-radius: 5px;
              width: 40%;
              height: 80%;
              max-height: 250;
              text-align: justify;
              overflow-y: auto;
          }

          .info h4 {
              margin: 0 0 5px;
              color: #777;
          }
          .legend .circle {
                          border-radius: 50%;
                          width: 10px;
                          height: 10px;
                          margin-top: 5px;
                          border:1px solid black;
                          -moz-border-radius:50%;
                          -webkit-border-radius:50%;
                        }
          .yearbox {
              padding: 6px 15px;
              font: 20px Arial, Helvetica, sans-serif;
              background: white;
              line-height: 20px;
              background: rgba(255,255,255,0.8);
              box-shadow: 0 0 15px rgba(0,0,0,0.2);
              border-radius: 5px;
              width: 150px;
              text-align: center;
          }

          #button-wrapper {
      position: absolute;
      bottom: 100px;
      z-index: 9999;
      width: 100%;
      border: 1px;
      background: rgba(255,255,255,0.8);
      box-shadow: 0 0 15px rgba(0,0,0,0.2);
      border-radius: 5px;
      width: 100px;
  }

  .button {
  background-color:yellow;
}

.button:focus {
  background-color:white;
}


        </style>
</head>

<body>
      <div id='map'></div>

      <script>

       var map = L.map('map', {


          //determines the slide zoom level of the initial map
          zoom:5,
          //ensure what is this control for, need to verify
          fullscreenControl: true,
          //ensures the timeDimension is active
          timeDimension: true,
          //determines the starting and finishing times of the slider, and the period of each step.
          //P1M means Period 1 Month.
          timeDimensionOptions: {
              timeInterval: "1943-01-01/1946-01-01",
              period: "P1D",
              },
          //ensure the time control slider is visible
          timeDimensionControl: true,
          //specifies the position of the time control slider
          timeDimensionControlOptions: {
              position: 'bottomleft',
              loopButton: 'true',
              autoPlay: true,
              minSpeed: 1,
              maxSpeed: 20,
              limitSliders: true,
              timeSliderDragUpdate: true,
              playerOptions: {
                    transitionTime: 100,
                    loop: false,
                    startOver:true,
                  }
              },
          //centres the map on certain coordinates
          center: [42, 12.5]
        }).setView([41.6, 8.857524], 5.1);
//This add the basemap to use for the map. Different types and style of basemap are available
      L.tileLayer('https://api.mapbox.com/styles/v1/simolandu/cjxj3tvl14zbj1cmpma7qd5ha/tiles/256/{z}/{x}/{y}@2x?access_token=pk.eyJ1Ijoic2ltb2xhbmR1IiwiYSI6ImNqM3d3YWxhejAwMG8zM3BjMTU4bW5laWYifQ.rhuk6FZECglxkElshWW5dg',
                  {
                  maxZoom: 18,
                  attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, '
                                + '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, '
                                + 'Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
                  }).addTo(map);


    L.control.coordinates({
                          position:           "bottomleft",
                          decimals:           2,
                          decimalSeperator:   ",",
                          labelTemplateLat:  "Latitude: {y}",
                          labelTemplateLng:  "Longitude: {x}"
                         }).addTo(map);


//this extends the original L.TimeDimension.Layer.GeoJson to look into the Geojson for
//a feature called time, and if it the Geojson returns it
function getColor(d) {
  if (d === "fascisti")
    return "#000";
  if (d === "nazisti")
    return "#f00";
  if (d === "nazifascisti")
      return "#B87333";
  if (d === "nn")
      return "#808080";
}

L.TimeDimension.Layer.Trail = L.TimeDimension.Layer.GeoJson.extend({

    // Do not modify features. Just return the feature if it intersects
    // the time interval
  _getFeatureBetweenDates: function(feature, minTime, maxTime) {
        var featureStringTimes = this._getFeatureTimes(feature);
        if (featureStringTimes.length == 0) {
            return feature;
        }

        var featureTimes = [];
        for (var i = 0, l = featureStringTimes.length; i < l; i++) {
            var time = featureStringTimes[i]
            if (typeof time == 'string' || time instanceof String) {
                time = Date.parse(time.trim());
            }
            featureTimes.push(time);
        }

        if (featureTimes[0] > maxTime || featureTimes[l - 1] < minTime) {
            return null;
        }
        return feature;
    },

});
L.timeDimension.layer.trail = function(layer, options) {
  return new L.TimeDimension.Layer.Trail(layer, options);
};


var nnLetterIcon = L.icon({
    iconUrl: './nnLetter.png',
    iconSize: [20,14.38],
    popupAnchor: [-10, -30],
  });
var nazistiLetterIcon = L.icon({
      iconUrl: './nazistiLetter.png',
      iconSize: [20,14.38],
      popupAnchor: [-10, -30],
    });
var fascistiLetterIcon = L.icon({
        iconUrl: './fascistiLetter.png',
        iconSize: [20,14.38],
        popupAnchor: [-10, -30],
      });
var nazifascistiLetterIcon = L.icon({
          iconUrl: './nazifascistiLetter.png',
          iconSize: [20,14.38],
          popupAnchor: [-10, -30],
        });

var nnArrestoIcon = L.icon({
    iconUrl: './nnArresto.svg',
    iconSize: [11.5,25],
    popupAnchor: [-10, -30],
  });
var nazistiArrestoIcon = L.icon({
      iconUrl: './nazistiArresto.svg',
      iconSize: [11.5,25],
      popupAnchor: [-10, -30],
    });
var fascistiArrestoIcon = L.icon({
        iconUrl: './fascistiArresto.svg',
        iconSize: [11.5,25],
        popupAnchor: [-10, -30],
      });
var nazifascistiArrestoIcon = L.icon({
          iconUrl: './nazifascistiArresto.svg',
          iconSize: [11.5,25],
          popupAnchor: [-10, -30],
        });

var jsonLayerVittimeNN =  L.geoJSON(  vittimaTest, {
    filter: function(feature, layer) {
          return feature.properties.autori_evento=="nn";
      },
    onEachFeature: function (feature, layer) {
      layer.bindPopup('<p>'+'<strong>'+feature.properties.nome+'</strong>'+
      '<br>'+'Luogo: '+feature.properties.luogo+
      '<br>'+'Tipologia: '+feature.properties.tipo+
      '<br>'+ 'Autori: '+feature.properties.autori_evento+
      '<br>'+ 'Data: '+feature.properties.data_intera+
      '<br>'+ 'Numero Vittime: '+feature.properties.vittime+
      '<br>'+ 'Descrizione: '+feature.properties.descrizione+
      '<br>'+ 'Origine Dati: '+feature.properties.origine_dati+'</p>'
    );

    },
    pointToLayer: function(feature, latLng) {
      //this
      if (feature.properties.origine_dati=="last_letters"){
         return L.marker(latLng,{icon: nnLetterIcon})
      }
     else if (feature.properties.origine_dati=="cdec"){
        return L.marker(latLng,{icon: nnArrestoIcon})
      }
     else if (feature.properties.origine_dati=="atlante_stragi"){
     return L.circleMarker(latLng,{
       radius: (Math.log10(feature.properties.vittime)+1)*4,
      // assigns fillColor based on function getColor using feature.properties.status as a parameter
      fillColor: "#808080",
      color: "#000",
      weight: 1,
      opacity: 1,
      fillOpacity: 1,
        })
      }
    }
  });
var jsonLayerVittimeNNStragi =  L.geoJSON(  vittimaTest, {
      filter: function(feature, layer) {
            return feature.properties.autori_evento=="nn" && feature.properties.origine_dati=="atlante_stragi";
        },
      onEachFeature: function (feature, layer) {
        layer.bindPopup('<p>'+'<strong>'+feature.properties.nome+'</strong>'+
        '<br>'+'Luogo: '+feature.properties.luogo+
        '<br>'+'Tipologia: '+feature.properties.tipo+
        '<br>'+ 'Autori: '+feature.properties.autori_evento+
        '<br>'+ 'Data: '+feature.properties.data_intera+
        '<br>'+ 'Numero Vittime: '+feature.properties.vittime+
        '<br>'+ 'Descrizione: '+feature.properties.descrizione+
        '<br>'+ 'Origine Dati: '+feature.properties.origine_dati+'</p>'
      );

      },
      pointToLayer: function(feature, latLng) {
       return L.circleMarker(latLng,{
         radius: (Math.log10(feature.properties.vittime)+1)*4,
        // assigns fillColor based on function getColor using feature.properties.status as a parameter
        fillColor: "#808080",
        color: "#000",
        weight: 1,
        opacity: 1,
        fillOpacity: 1,
          })
        }
      });
var jsonLayerVittimeNNLettere =  L.geoJSON(  vittimaTest, {
          filter: function(feature, layer) {
             return feature.properties.autori_evento=="nn" && feature.properties.origine_dati=="last_letters";
            },
          onEachFeature: function (feature, layer) {
            layer.bindPopup('<p>'+'<strong>'+feature.properties.nome+'</strong>'+
            '<br>'+'Luogo: '+feature.properties.luogo+
            '<br>'+'Tipologia: '+feature.properties.tipo+
            '<br>'+ 'Autori: '+feature.properties.autori_evento+
            '<br>'+ 'Data: '+feature.properties.data_intera+
            '<br>'+ 'Numero Vittime: '+feature.properties.vittime+
            '<br>'+ 'Descrizione: '+feature.properties.descrizione+
            '<br>'+ 'Origine Dati: '+feature.properties.origine_dati+'</p>'
          );

          },
          pointToLayer: function(feature, latLng) {
            //this
               return L.marker(latLng,{icon: nnLetterIcon})
          }
        });
        var jsonLayerVittimeNNLettere =  L.geoJSON(  vittimaTest, {
                  filter: function(feature, layer) {
                     return feature.properties.autori_evento=="nn" && feature.properties.origine_dati=="last_letters";
                    },
                  onEachFeature: function (feature, layer) {
                    layer.bindPopup('<p>'+'<strong>'+feature.properties.nome+'</strong>'+
                    '<br>'+'Luogo: '+feature.properties.luogo+
                    '<br>'+'Tipologia: '+feature.properties.tipo+
                    '<br>'+ 'Autori: '+feature.properties.autori_evento+
                    '<br>'+ 'Data: '+feature.properties.data_intera+
                    '<br>'+ 'Numero Vittime: '+feature.properties.vittime+
                    '<br>'+ 'Descrizione: '+feature.properties.descrizione+
                    '<br>'+ 'Origine Dati: '+feature.properties.origine_dati+'</p>'
                  );

                  },
                  pointToLayer: function(feature, latLng) {
                    //this
                       return L.marker(latLng,{icon: nnLetterIcon})
                  }
                });
var jsonLayerVittimeNNArresto =  L.geoJSON(  vittimaTest, {
              filter: function(feature, layer) {
                 return feature.properties.autori_evento=="nn" && feature.properties.origine_dati=="cdec";
                },
              onEachFeature: function (feature, layer) {
                layer.bindPopup('<p>'+'<strong>'+feature.properties.nome+'</strong>'+
                '<br>'+'Luogo: '+feature.properties.luogo+
                '<br>'+'Tipologia: '+feature.properties.tipo+
                '<br>'+ 'Autori: '+feature.properties.autori_evento+
                '<br>'+ 'Data: '+feature.properties.data_intera+
                '<br>'+ 'Numero Vittime: '+feature.properties.vittime+
                '<br>'+ 'Descrizione: '+feature.properties.descrizione+
                '<br>'+ 'Origine Dati: '+feature.properties.origine_dati+'</p>'
              );

              },
              pointToLayer: function(feature, latLng) {
                //this
                   return L.marker(latLng,{icon: nnArrestoIcon})
              }
            });

var jsonLayerVittimeNazifascisti =  L.geoJSON(  vittimaTest, {
    filter: function(feature, layer) {
          return feature.properties.autori_evento=="nazifascisti";
      },
    onEachFeature: function (feature, layer) {
      layer.bindPopup('<p>'+'<strong>'+feature.properties.nome+'</strong>'+
      '<br>'+'Luogo: '+feature.properties.luogo+
      '<br>'+'Tipologia: '+feature.properties.tipo+
      '<br>'+ 'Autori: '+feature.properties.autori_evento+
      '<br>'+ 'Data: '+feature.properties.data_intera+
      '<br>'+ 'Numero Vittime: '+feature.properties.vittime+
      '<br>'+ 'Descrizione: '+feature.properties.descrizione+
      '<br>'+ 'Origine Dati: '+feature.properties.origine_dati+'</p>'
    );
    },

    pointToLayer: function(feature, latLng) {
      //this
      if (feature.properties.origine_dati=="last_letters"){
         return L.marker(latLng,{icon: nazifascistiLetterIcon})
      }
     else if (feature.properties.origine_dati=="cdec"){
        return L.marker(latLng,{icon: nazifascistiArrestoIcon})
      }
     else if (feature.properties.origine_dati=="atlante_stragi"){
     return L.circleMarker(latLng,{
       radius: (Math.log10(feature.properties.vittime)+1)*4,
      // assigns fillColor based on function getColor using feature.properties.status as a parameter
      fillColor: "#B87333",
      color: "#000",
      weight: 1,
      opacity: 1,
      fillOpacity: 1,
        })
      }
    }
  });
var jsonLayerVittimeNazifascistiStragi =  L.geoJSON(  vittimaTest, {
      filter: function(feature, layer) {
            return feature.properties.autori_evento=="nazifascisti" && feature.properties.origine_dati=="atlante_stragi";
        },
      onEachFeature: function (feature, layer) {
        layer.bindPopup('<p>'+'<strong>'+feature.properties.nome+'</strong>'+
        '<br>'+'Luogo: '+feature.properties.luogo+
        '<br>'+'Tipologia: '+feature.properties.tipo+
        '<br>'+ 'Autori: '+feature.properties.autori_evento+
        '<br>'+ 'Data: '+feature.properties.data_intera+
        '<br>'+ 'Numero Vittime: '+feature.properties.vittime+
        '<br>'+ 'Descrizione: '+feature.properties.descrizione+
        '<br>'+ 'Origine Dati: '+feature.properties.origine_dati+'</p>'
      );
      },

      pointToLayer: function(feature, latLng) {
        //this

       return L.circleMarker(latLng,{
         radius: (Math.log10(feature.properties.vittime)+1)*4,
        // assigns fillColor based on function getColor using feature.properties.status as a parameter
        fillColor: "#B87333",
        color: "#000",
        weight: 1,
        opacity: 1,
        fillOpacity: 1,
          })

      }
    });
var jsonLayerVittimeNazifascistiLettere =  L.geoJSON(  vittimaTest, {
          filter: function(feature, layer) {
                return feature.properties.autori_evento=="nazifascisti" && feature.properties.origine_dati=="last_letters";
            },
          onEachFeature: function (feature, layer) {
            layer.bindPopup('<p>'+'<strong>'+feature.properties.nome+'</strong>'+
            '<br>'+'Luogo: '+feature.properties.luogo+
            '<br>'+'Tipologia: '+feature.properties.tipo+
            '<br>'+ 'Autori: '+feature.properties.autori_evento+
            '<br>'+ 'Data: '+feature.properties.data_intera+
            '<br>'+ 'Numero Vittime: '+feature.properties.vittime+
            '<br>'+ 'Descrizione: '+feature.properties.descrizione+
            '<br>'+ 'Origine Dati: '+feature.properties.origine_dati+'</p>'
          );
          },
          pointToLayer: function(feature, latLng) {
            //this
            return L.marker(latLng,{icon: nazifascistiLetterIcon})
          }
        });
var jsonLayerVittimeNazifascistiArresto =  L.geoJSON(  vittimaTest, {
                  filter: function(feature, layer) {
                        return feature.properties.autori_evento=="nazifascisti" && feature.properties.origine_dati=="cdec";
                    },
                  onEachFeature: function (feature, layer) {
                    layer.bindPopup('<p>'+'<strong>'+feature.properties.nome+'</strong>'+
                    '<br>'+'Luogo: '+feature.properties.luogo+
                    '<br>'+'Tipologia: '+feature.properties.tipo+
                    '<br>'+ 'Autori: '+feature.properties.autori_evento+
                    '<br>'+ 'Data: '+feature.properties.data_intera+
                    '<br>'+ 'Numero Vittime: '+feature.properties.vittime+
                    '<br>'+ 'Descrizione: '+feature.properties.descrizione+
                    '<br>'+ 'Origine Dati: '+feature.properties.origine_dati+'</p>'
                  );
                  },
                  pointToLayer: function(feature, latLng) {
                    //this
                    return L.marker(latLng,{icon: nazifascistiArrestoIcon})
                  }
                });

var jsonLayerVittimeNazisti =  L.geoJSON(  vittimaTest, {
    filter: function(feature, layer) {
          return feature.properties.autori_evento=="nazisti";
      },
    onEachFeature: function (feature, layer) {
      layer.bindPopup('<p>'+'<strong>'+feature.properties.nome+'</strong>'+
      '<br>'+'Luogo: '+feature.properties.luogo+
      '<br>'+'Tipologia: '+feature.properties.tipo+
      '<br>'+ 'Autori: '+feature.properties.autori_evento+
      '<br>'+ 'Data: '+feature.properties.data_intera+
      '<br>'+ 'Numero Vittime: '+feature.properties.vittime+
      '<br>'+ 'Descrizione: '+feature.properties.descrizione+
      '<br>'+ 'Origine Dati: '+feature.properties.origine_dati+'</p>'
    );
    },
    pointToLayer: function(feature, latLng) {
      //this
      if (feature.properties.origine_dati=="last_letters"){
         return L.marker(latLng,{icon: nazistiLetterIcon})
      }
     else if (feature.properties.origine_dati=="cdec"){
        return L.marker(latLng,{icon: nazistiArrestoIcon})
      }
     else if (feature.properties.origine_dati=="atlante_stragi"){
     return L.circleMarker(latLng,{
       radius: (Math.log10(feature.properties.vittime)+1)*4,
      // assigns fillColor based on function getColor using feature.properties.status as a parameter
      fillColor: "#f00",
      color: "#000",
      weight: 1,
      opacity: 1,
      fillOpacity: 1,
        })
      }
    }
  });
var jsonLayerVittimeNazistiStragi =  L.geoJSON(  vittimaTest, {
      filter: function(feature, layer) {
            return feature.properties.autori_evento=="nazisti" && feature.properties.origine_dati=="atlante_stragi";
        },
      onEachFeature: function (feature, layer) {
        layer.bindPopup('<p>'+'<strong>'+feature.properties.nome+'</strong>'+
        '<br>'+'Luogo: '+feature.properties.luogo+
        '<br>'+'Tipologia: '+feature.properties.tipo+
        '<br>'+ 'Autori: '+feature.properties.autori_evento+
        '<br>'+ 'Data: '+feature.properties.data_intera+
        '<br>'+ 'Numero Vittime: '+feature.properties.vittime+
        '<br>'+ 'Descrizione: '+feature.properties.descrizione+
        '<br>'+ 'Origine Dati: '+feature.properties.origine_dati+'</p>'
      );
      },
      pointToLayer: function(feature, latLng) {
        //this

       return L.circleMarker(latLng,{
         radius: (Math.log10(feature.properties.vittime)+1)*4,
        // assigns fillColor based on function getColor using feature.properties.status as a parameter
        fillColor: "#f00",
        color: "#000",
        weight: 1,
        opacity: 1,
        fillOpacity: 1,
          })

      }
    });
var jsonLayerVittimeNazistiLettere =  L.geoJSON(  vittimaTest, {
        filter: function(feature, layer) {
              return feature.properties.autori_evento=="nazisti" && feature.properties.origine_dati=="last_letters";
          },
        onEachFeature: function (feature, layer) {
          layer.bindPopup('<p>'+'<strong>'+feature.properties.nome+'</strong>'+
          '<br>'+'Luogo: '+feature.properties.luogo+
          '<br>'+'Tipologia: '+feature.properties.tipo+
          '<br>'+ 'Autori: '+feature.properties.autori_evento+
          '<br>'+ 'Data: '+feature.properties.data_intera+
          '<br>'+ 'Numero Vittime: '+feature.properties.vittime+
          '<br>'+ 'Descrizione: '+feature.properties.descrizione+
          '<br>'+ 'Origine Dati: '+feature.properties.origine_dati+'</p>'
        );
        },
        pointToLayer: function(feature, latLng) {
          //this
             return L.marker(latLng,{icon: nazistiLetterIcon})
        }
      });
var jsonLayerVittimeNazistiArresto =  L.geoJSON(  vittimaTest, {
              filter: function(feature, layer) {
                    return feature.properties.autori_evento=="nazisti" && feature.properties.origine_dati=="cdec";
                },
              onEachFeature: function (feature, layer) {
                layer.bindPopup('<p>'+'<strong>'+feature.properties.nome+'</strong>'+
                '<br>'+'Luogo: '+feature.properties.luogo+
                '<br>'+'Tipologia: '+feature.properties.tipo+
                '<br>'+ 'Autori: '+feature.properties.autori_evento+
                '<br>'+ 'Data: '+feature.properties.data_intera+
                '<br>'+ 'Numero Vittime: '+feature.properties.vittime+
                '<br>'+ 'Descrizione: '+feature.properties.descrizione+
                '<br>'+ 'Origine Dati: '+feature.properties.origine_dati+'</p>'
              );
              },
              pointToLayer: function(feature, latLng) {
                //this
                   return L.marker(latLng,{icon: nazistiArrestoIcon})
              }
            });

var jsonLayerVittimeFascisti =  L.geoJSON(  vittimaTest, {
    filter: function(feature, layer) {
          return feature.properties.autori_evento=="fascisti";
      },
    onEachFeature: function (feature, layer) {
      layer.bindPopup('<p>'+'<strong>'+feature.properties.nome+'</strong>'+
      '<br>'+'Luogo: '+feature.properties.luogo+
      '<br>'+'Tipologia: '+feature.properties.tipo+
      '<br>'+ 'Autori: '+feature.properties.autori_evento+
      '<br>'+ 'Data: '+feature.properties.data_intera+
      '<br>'+ 'Numero Vittime: '+feature.properties.vittime+
      '<br>'+ 'Descrizione: '+feature.properties.descrizione+
      '<br>'+ 'Origine Dati: '+feature.properties.origine_dati+'</p>'
    );
    },
    pointToLayer: function(feature, latLng) {
      //this
      if (feature.properties.origine_dati=="last_letters"){
         return L.marker(latLng,{icon: fascistiLetterIcon})
      }
     else if (feature.properties.origine_dati=="cdec"){
        return L.marker(latLng,{icon: fascistiArrestoIcon})
      }
     else if (feature.properties.origine_dati=="atlante_stragi"){
     return L.circleMarker(latLng,{
       radius: (Math.log10(feature.properties.vittime)+1)*4,
      // assigns fillColor based on function getColor using feature.properties.status as a parameter
      fillColor: "#000",
      color: "#fff",
      weight: 1,
      opacity: 1,
      fillOpacity: 1,
        })
      }
    }
  });
var jsonLayerVittimeFascistiStragi =  L.geoJSON(  vittimaTest, {
      filter: function(feature, layer) {
            return feature.properties.autori_evento=="fascisti" && feature.properties.origine_dati=="atlante_stragi";
        },
      onEachFeature: function (feature, layer) {
        layer.bindPopup('<p>'+'<strong>'+feature.properties.nome+'</strong>'+
        '<br>'+'Luogo: '+feature.properties.luogo+
        '<br>'+'Tipologia: '+feature.properties.tipo+
        '<br>'+ 'Autori: '+feature.properties.autori_evento+
        '<br>'+ 'Data: '+feature.properties.data_intera+
        '<br>'+ 'Numero Vittime: '+feature.properties.vittime+
        '<br>'+ 'Descrizione: '+feature.properties.descrizione+
        '<br>'+ 'Origine Dati: '+feature.properties.origine_dati+'</p>'
      );
      },
      pointToLayer: function(feature, latLng) {
        //this

       return L.circleMarker(latLng,{
         radius: (Math.log10(feature.properties.vittime)+1)*4,
        // assigns fillColor based on function getColor using feature.properties.status as a parameter
        fillColor: "#000",
        color: "#fff",
        weight: 1,
        opacity: 1,
        fillOpacity: 1,
          })
      }
    });
var jsonLayerVittimeFascistiLettere =  L.geoJSON(  vittimaTest, {
        filter: function(feature, layer) {
              return feature.properties.autori_evento=="fascisti"&&feature.properties.origine_dati=="last_letters";
          },
        onEachFeature: function (feature, layer) {
          layer.bindPopup('<p>'+'<strong>'+feature.properties.nome+'</strong>'+
          '<br>'+'Luogo: '+feature.properties.luogo+
          '<br>'+'Tipologia: '+feature.properties.tipo+
          '<br>'+ 'Autori: '+feature.properties.autori_evento+
          '<br>'+ 'Data: '+feature.properties.data_intera+
          '<br>'+ 'Numero Vittime: '+feature.properties.vittime+
          '<br>'+ 'Descrizione: '+feature.properties.descrizione+
          '<br>'+ 'Origine Dati: '+feature.properties.origine_dati+'</p>'
        );
        },
        pointToLayer: function(feature, latLng) {
          //this
             return L.marker(latLng,{icon: fascistiLetterIcon})
        }
      });
var jsonLayerVittimeFascistiArresto =  L.geoJSON(  vittimaTest, {
        filter: function(feature, layer) {
              return feature.properties.autori_evento=="fascisti"&&feature.properties.origine_dati=="cdec";
          },
        onEachFeature: function (feature, layer) {
          layer.bindPopup('<p>'+'<strong>'+feature.properties.nome+'</strong>'+
          '<br>'+'Luogo: '+feature.properties.luogo+
          '<br>'+'Tipologia: '+feature.properties.tipo+
          '<br>'+ 'Autori: '+feature.properties.autori_evento+
          '<br>'+ 'Data: '+feature.properties.data_intera+
          '<br>'+ 'Numero Vittime: '+feature.properties.vittime+
          '<br>'+ 'Descrizione: '+feature.properties.descrizione+
          '<br>'+ 'Origine Dati: '+feature.properties.origine_dati+'</p>'
        );
        },
        pointToLayer: function(feature, latLng) {
          //this
             return L.marker(latLng,{icon: fascistiArrestoIcon})
        }
      });

var jsonLayerVittimeLastLetters =  L.geoJSON(  vittimaTest, {
      filter: function(feature, layer) {
            return feature.properties.origine_dati=="last_letters";
        },
      onEachFeature: function (feature, layer) {
        layer.bindPopup('<p>'+'<strong>'+feature.properties.nome+'</strong>'+
        '<br>'+'Luogo: '+feature.properties.luogo+
        '<br>'+'Tipologia: '+feature.properties.tipo+
        '<br>'+ 'Autori: '+feature.properties.autori_evento+
        '<br>'+ 'Data: '+feature.properties.data_intera+
        '<br>'+ 'Numero Vittime: '+feature.properties.vittime+
        '<br>'+ 'Descrizione: '+feature.properties.descrizione+
        '<br>'+ 'Origine Dati: '+feature.properties.origine_dati+'</p>'
      );
      },
      pointToLayer: function(feature, latLng) {
        //this
        if (feature.properties.autori_evento=="fascisti"){
           return L.marker(latLng,{icon: fascistiLetterIcon})
        }
       else if (feature.properties.autori_evento=="nazisti"){
          return L.marker(latLng,{icon: nazistiLetterIcon})
       }
       else if (feature.properties.autori_evento=="nazifascisti"){
          return L.marker(latLng,{icon: nazifascistiLetterIcon})
       }
       else if (feature.properties.autori_evento=="nn"){
          return L.marker(latLng,{icon: nnLetterIcon})
       }
      }
    });
var jsonLayerVittimeArresti =  L.geoJSON(  vittimaTest, {
          filter: function(feature, layer) {
                return feature.properties.origine_dati=="cdec";
            },
          onEachFeature: function (feature, layer) {
            layer.bindPopup('<p>'+'<strong>'+feature.properties.nome+'</strong>'+
            '<br>'+'Luogo: '+feature.properties.luogo+
            '<br>'+'Tipologia: '+feature.properties.tipo+
            '<br>'+ 'Autori: '+feature.properties.autori_evento+
            '<br>'+ 'Data: '+feature.properties.data_intera+
            '<br>'+ 'Numero Vittime: '+feature.properties.vittime+
            '<br>'+ 'Descrizione: '+feature.properties.descrizione+
            '<br>'+ 'Origine Dati: '+feature.properties.origine_dati+'</p>'
          );
          },
          pointToLayer: function(feature, latLng) {
            //this
            if (feature.properties.autori_evento=="fascisti"){
               return L.marker(latLng,{icon: fascistiArrestoIcon})
            }
           else if (feature.properties.autori_evento=="nazisti"){
              return L.marker(latLng,{icon: nazistiArrestoIcon})
           }
           else if (feature.properties.autori_evento=="nazifascisti"){
              return L.marker(latLng,{icon: nazifascistiArrestoIcon})
           }
           else if (feature.properties.autori_evento=="nn"){
              return L.marker(latLng,{icon: nnArrestoIcon})
           }
          }
        });
var jsonLayerVittimeStragi =  L.geoJSON(  vittimaTest, {
            filter: function(feature, layer) {
                  return feature.properties.origine_dati=="atlante_stragi";
              },
            onEachFeature: function (feature, layer) {
              layer.bindPopup('<p>'+'<strong>'+feature.properties.nome+'</strong>'+
              '<br>'+'Luogo: '+feature.properties.luogo+
              '<br>'+'Tipologia: '+feature.properties.tipo+
              '<br>'+ 'Autori: '+feature.properties.autori_evento+
              '<br>'+ 'Data: '+feature.properties.data_intera+
              '<br>'+ 'Numero Vittime: '+feature.properties.vittime+
              '<br>'+ 'Descrizione: '+feature.properties.descrizione+
              '<br>'+ 'Origine Dati: '+feature.properties.origine_dati+'</p>'
            );
            },
            pointToLayer: function(feature, latLng) {
              //this
               if (feature.properties.autori_evento=="fascisti"){
              return L.circleMarker(latLng,{
                radius: (Math.log10(feature.properties.vittime)+1)*4,
               // assigns fillColor based on function getColor using feature.properties.status as a parameter
               fillColor: "#000",
               color: "#fff",
               weight: 1,
               opacity: 1,
               fillOpacity: 1,
                 })
               }

              else if (feature.properties.autori_evento=="nazisti"){
              return L.circleMarker(latLng,{
                radius: (Math.log10(feature.properties.vittime)+1)*4,
               // assigns fillColor based on function getColor using feature.properties.status as a parameter
               fillColor: "#f00",
               color: "#000",
               weight: 1,
               opacity: 1,
               fillOpacity: 1,
                 })
               }
              else if (feature.properties.autori_evento=="nazifascisti"){
              return L.circleMarker(latLng,{
                radius: (Math.log10(feature.properties.vittime)+1)*4,
               // assigns fillColor based on function getColor using feature.properties.status as a parameter
               fillColor: "#B87333",
               color: "#000",
               weight: 1,
               opacity: 1,
               fillOpacity: 1,
                 })
               }
             else if (feature.properties.autori_evento=="nn"){
             return L.circleMarker(latLng,{
               radius: (Math.log10(feature.properties.vittime)+1)*4,
              // assigns fillColor based on function getColor using feature.properties.status as a parameter
              fillColor: "#808080",
              color: "#000",
              weight: 1,
              opacity: 1,
              fillOpacity: 1,
                })
              }
            }
          });

var italia1 = L.geoJSON (italia1);
var italia2 = L.geoJSON (italia2);
var italia3 = L.geoJSON (italia3);
var italia4 = L.geoJSON (italia4);
var italia5 = L.geoJSON (italia5);

var imageUrl = "http://localhost:8080/geoserver/mappaItalia/wms?service=WMS&version=1.1.0&request=GetMap&layers=mappaItalia:geotiff_coverage&styles=&bbox=6.841904159208746,35.83424184241142,18.749848579175044,47.30605487747379&width=768&height=739&srs=EPSG:4326&format=image%2Fjpeg",
    imageBounds = [[35.8342418424114229,6.8419041592087462], [47.3060548774737910,18.7498485791750440]];
var mappaItalia1 = L.imageOverlay(imageUrl, imageBounds);



var timedimension8 = L.timeDimension.layer.trail(italia1, {
  updateTimeDimension: false, //Update the list of available times of the attached TimeDimension with the available times of this GeoJSON, if it is false it does not work
  updateTimeDimensionMode: 'union', //changing this changes the way the point appear on the map
  duration: 'P1D',//how long the feature remains there until its time as passed
});
var timedimension9 = L.timeDimension.layer.trail(italia2, {
  updateTimeDimension: false, //Update the list of available times of the attached TimeDimension with the available times of this GeoJSON, if it is false it does not work
  updateTimeDimensionMode: 'union', //changing this changes the way the point appear on the map
  duration: 'P1D',//how long the feature remains there until its time as passed
});
var timedimension10 = L.timeDimension.layer.trail(italia3, {
  updateTimeDimension: false, //Update the list of available times of the attached TimeDimension with the available times of this GeoJSON, if it is false it does not work
  updateTimeDimensionMode: 'union', //changing this changes the way the point appear on the map
  duration: 'P1D',//how long the feature remains there until its time as passed
});
var timedimension11 = L.timeDimension.layer.trail(italia4, {
  updateTimeDimension: false, //Update the list of available times of the attached TimeDimension with the available times of this GeoJSON, if it is false it does not work
  updateTimeDimensionMode: 'union', //changing this changes the way the point appear on the map
  duration: 'P1D',//how long the feature remains there until its time as passed
});
var timedimension12 = L.timeDimension.layer.trail(italia5, {
  updateTimeDimension: false, //Update the list of available times of the attached TimeDimension with the available times of this GeoJSON, if it is false it does not work
  updateTimeDimensionMode: 'union', //changing this changes the way the point appear on the map
  duration: 'P1D',//how long the feature remains there until its time as passed
});

var Italia = L.layerGroup([timedimension8, timedimension9, timedimension10, timedimension11, timedimension12]);

var timedimensionFascisti = L.timeDimension.layer.geoJson(jsonLayerVittimeFascisti, {
  updateTimeDimension: false, //Update the list of available times of the attached TimeDimension with the available times of this GeoJSON, if it is false it does not work
  updateTimeDimensionMode: 'union', //changing this changes the way the point appear on the map
  duration: 'P1D',//how long the feature remains there until its time as passed
}).addTo(map);
var timedimensionNazisti = L.timeDimension.layer.geoJson(jsonLayerVittimeNazisti, {
  updateTimeDimension: false, //Update the list of available times of the attached TimeDimension with the available times of this GeoJSON, if it is false it does not work
  updateTimeDimensionMode: 'union', //changing this changes the way the point appear on the map
  duration: 'P1D',//how long the feature remains there until its time as passed
}).addTo(map);
var timedimensionNazifascisti = L.timeDimension.layer.geoJson(jsonLayerVittimeNazifascisti, {
  updateTimeDimension: false, //Update the list of available times of the attached TimeDimension with the available times of this GeoJSON, if it is false it does not work
  updateTimeDimensionMode: 'union', //changing this changes the way the point appear on the map
  duration: 'P1D',//how long the feature remains there until its time as passed
}).addTo(map);
var timedimensionNN = L.timeDimension.layer.geoJson(jsonLayerVittimeNN, {
  updateTimeDimension: false, //Update the list of available times of the attached TimeDimension with the available times of this GeoJSON, if it is false it does not work
  updateTimeDimensionMode: 'union', //changing this changes the way the point appear on the map
  duration: 'P1D',//how long the feature remains there until its time as passed
}).addTo(map);
var timedimensionLastLettere = L.timeDimension.layer.geoJson(jsonLayerVittimeLastLetters, {
  updateTimeDimension: false, //Update the list of available times of the attached TimeDimension with the available times of this GeoJSON, if it is false it does not work
  updateTimeDimensionMode: 'union', //changing this changes the way the point appear on the map
  duration: 'P1D',//how long the feature remains there until its time as passed
});
var timedimensionArresti = L.timeDimension.layer.geoJson(jsonLayerVittimeArresti, {
  updateTimeDimension: false, //Update the list of available times of the attached TimeDimension with the available times of this GeoJSON, if it is false it does not work
  updateTimeDimensionMode: 'union', //changing this changes the way the point appear on the map
  duration: 'P1D',//how long the feature remains there until its time as passed
});
var timedimensionStragi = L.timeDimension.layer.geoJson(jsonLayerVittimeStragi, {
  updateTimeDimension: false, //Update the list of available times of the attached TimeDimension with the available times of this GeoJSON, if it is false it does not work
  updateTimeDimensionMode: 'union', //changing this changes the way the point appear on the map
  duration: 'P1D',//how long the feature remains there until its time as passed
});

var timedimensionNNStragi = L.timeDimension.layer.geoJson(jsonLayerVittimeNNStragi, {
  updateTimeDimension: false, //Update the list of available times of the attached TimeDimension with the available times of this GeoJSON, if it is false it does not work
  updateTimeDimensionMode: 'union', //changing this changes the way the point appear on the map
  duration: 'P1D',//how long the feature remains there until its time as passed
});
var timedimensionNNArresto = L.timeDimension.layer.geoJson(jsonLayerVittimeNNArresto, {
  updateTimeDimension: false, //Update the list of available times of the attached TimeDimension with the available times of this GeoJSON, if it is false it does not work
  updateTimeDimensionMode: 'union', //changing this changes the way the point appear on the map
  duration: 'P1D',//how long the feature remains there until its time as passed
});
var timedimensionNNLettere = L.timeDimension.layer.geoJson(jsonLayerVittimeNNLettere, {
  updateTimeDimension: false, //Update the list of available times of the attached TimeDimension with the available times of this GeoJSON, if it is false it does not work
  updateTimeDimensionMode: 'union', //changing this changes the way the point appear on the map
  duration: 'P1D',//how long the feature remains there until its time as passed
});

var timedimensionNazifascistiStragi = L.timeDimension.layer.geoJson(jsonLayerVittimeNazifascistiStragi, {
  updateTimeDimension: false, //Update the list of available times of the attached TimeDimension with the available times of this GeoJSON, if it is false it does not work
  updateTimeDimensionMode: 'union', //changing this changes the way the point appear on the map
  duration: 'P1D',//how long the feature remains there until its time as passed
});
var timedimensionNazifascistiArresto = L.timeDimension.layer.geoJson(jsonLayerVittimeNazifascistiArresto, {
  updateTimeDimension: false, //Update the list of available times of the attached TimeDimension with the available times of this GeoJSON, if it is false it does not work
  updateTimeDimensionMode: 'union', //changing this changes the way the point appear on the map
  duration: 'P1D',//how long the feature remains there until its time as passed
});
var timedimensionNazifascistiLettere = L.timeDimension.layer.geoJson(jsonLayerVittimeNazifascistiLettere, {
  updateTimeDimension: false, //Update the list of available times of the attached TimeDimension with the available times of this GeoJSON, if it is false it does not work
  updateTimeDimensionMode: 'union', //changing this changes the way the point appear on the map
  duration: 'P1D',//how long the feature remains there until its time as passed
});

var timedimensionNazistiStragi = L.timeDimension.layer.geoJson(jsonLayerVittimeNazistiStragi, {
  updateTimeDimension: false, //Update the list of available times of the attached TimeDimension with the available times of this GeoJSON, if it is false it does not work
  updateTimeDimensionMode: 'union', //changing this changes the way the point appear on the map
  duration: 'P1D',//how long the feature remains there until its time as passed
});
var timedimensionNazistiArresto = L.timeDimension.layer.geoJson(jsonLayerVittimeNazistiArresto, {
  updateTimeDimension: false, //Update the list of available times of the attached TimeDimension with the available times of this GeoJSON, if it is false it does not work
  updateTimeDimensionMode: 'union', //changing this changes the way the point appear on the map
  duration: 'P1D',//how long the feature remains there until its time as passed
});
var timedimensionNazistiLettere = L.timeDimension.layer.geoJson(jsonLayerVittimeNazistiLettere, {
  updateTimeDimension: false, //Update the list of available times of the attached TimeDimension with the available times of this GeoJSON, if it is false it does not work
  updateTimeDimensionMode: 'union', //changing this changes the way the point appear on the map
  duration: 'P1D',//how long the feature remains there until its time as passed
});

var timedimensionFascistiStragi = L.timeDimension.layer.geoJson(jsonLayerVittimeFascistiStragi, {
  updateTimeDimension: false, //Update the list of available times of the attached TimeDimension with the available times of this GeoJSON, if it is false it does not work
  updateTimeDimensionMode: 'union', //changing this changes the way the point appear on the map
  duration: 'P1D',//how long the feature remains there until its time as passed
});
var timedimensionFascistiArresto = L.timeDimension.layer.geoJson(jsonLayerVittimeFascistiArresto, {
  updateTimeDimension: false, //Update the list of available times of the attached TimeDimension with the available times of this GeoJSON, if it is false it does not work
  updateTimeDimensionMode: 'union', //changing this changes the way the point appear on the map
  duration: 'P1D',//how long the feature remains there until its time as passed
});
var timedimensionFascistiLettere = L.timeDimension.layer.geoJson(jsonLayerVittimeFascistiLettere, {
  updateTimeDimension: false, //Update the list of available times of the attached TimeDimension with the available times of this GeoJSON, if it is false it does not work
  updateTimeDimensionMode: 'union', //changing this changes the way the point appear on the map
  duration: 'P1D',//how long the feature remains there until its time as passed
});

var baseMaps = {

    "Empty map": map,
    "Chronological Map":Italia,
    "Advanced of the Allies": mappaItalia1,
};
var overlayMaps = {

    "Fascists": timedimensionFascisti,
    "Nazis": timedimensionNazisti,
    "Nazis and Fascists": timedimensionNazifascisti,
    "Unknown": timedimensionNN,

    "Last Letters": timedimensionLastLettere,
    "Arrests": timedimensionArresti,
    "Massacres": timedimensionStragi,
/*
    "NNStragi": timedimensionNNStragi,
    "NNArresto": timedimensionNNArresto,
    "NNLettere":timedimensionNNLettere,
    "NFStragi":timedimensionNazifascistiStragi,
    "NFArresto":timedimensionNazifascistiArresto,
    "NFLettere":timedimensionNazifascistiLettere,
    "NStragi":timedimensionNazistiStragi,
    "NArresto":timedimensionNazistiArresto,
    "NLettere":timedimensionNazistiLettere,
    "FStragi":timedimensionFascistiStragi,
    "FArresto":timedimensionFascistiArresto,
    "FLettere":timedimensionFascistiLettere,
    */
};
/*
var Fascistibutton = new L.Control.Button('Fascisti', {
  toggleButton: 'active'
});
Fascistibutton.addTo(map);

var Nazistibutton = new L.Control.Button('Nazisti', {
  toggleButton: 'active'
});
Nazistibutton.addTo(map);

var Nazifascistibutton = new L.Control.Button('Nazifascisti', {
  toggleButton: 'active'
});
Nazifascistibutton.addTo(map);

var NNbutton = new L.Control.Button('Non Noti', {
  toggleButton: 'active'
});
NNbutton.addTo(map);

var Letterebutton = new L.Control.Button('Lettere', {
  toggleButton: 'active'
});
Letterebutton.addTo(map);

var Stragibutton = new L.Control.Button('Stragi', {
  toggleButton: 'active'
});
Stragibutton.addTo(map);

var Arrestobutton = new L.Control.Button('Arresto', {
  toggleButton: 'active'
});
Arrestobutton.addTo(map);

var Tuttobutton = new L.Control.Button('Tutto', {
  toggleButton: 'active'
});
Tuttobutton.addTo(map);


Fascistibutton.on('click', function () {
    if (Fascistibutton.isToggled() && Stragibutton.isToggled()) {
          map.addLayer(timedimensionFascistiStragi);
    } else if(Fascistibutton.isToggled() && Arrestobutton.isToggled()) {
                map.addLayer(timedimensionFascistiArresto);
    }
    else if(Fascistibutton.isToggled() && Letterebutton.isToggled()) {
                map.addLayer(timedimensionFascistiLettere);
    }
});
*/
L.control.layers(baseMaps,overlayMaps).addTo(map);

var title = L.control({position: 'topleft'});

title.onAdd = function (map) {

var div = L.DomUtil.create('div', 'disclaimer');
    div.innerHTML +=
    '<h1 style="font-size:1.5vw;">Atlas of Nazi-Fascist Repression</h1>'+
    '<p><b>Giovanni Pietro Vitali</b> - University College Cork <br>Marie SkÅodowska Curie Action European Fellow</br>giovannipietrovitali@gmail.com</p>'+
    '<p><b>Simone Landucci</b> - Urban and Regional Planner <br>landuccismn@gmail.com</br></p>'+
    '<p><i>This chronological map tells the story of the violence carried out on the Italian population by the Nazis and the Fascists during the Second World War. On the right side of the map you can find the legends. The colours indicate who was responsible for the acts of violence against the population. The envelope icon indicates the data taken from the last letters dataset (<b>http://www.ultimelettere.it</b>), the handcuffed man icon indicates the racial arrests collected thanks to the CDEC (<b>http://www.cdec.it</b>) and the dot indicates the massacres collected by the research team of the atlas of Nazi-Fascist massacres (<b>http://www.straginazifasciste.it/</b>). This dot is as large as the number of victims killed in each single event. On the bottom part of the map, the speed of the chronology can be adjusted using the speed selector on the right side of the bar. On the bottom right-hand corner of the map there is the visualization of the dates.</i> </p>'

    return div;
};

//title.addTo(map);


var legend = L.control({position: 'topright'});

legend.onAdd = function (map) {

var div = L.DomUtil.create('div', 'info legend'),
  categories = ["fascisti", "nazisti", "nazifascisti", "nn"],
  labels = ["Fascists","Nazis","Nazis and Fascists","Unknown"];
    div.innerHTML += '<b>Legend of Colours</b><br>'
    // loop through our density intervals and generate a label with a colored square for each interval
    for (var i = 0; i < categories.length; i++) {
      div.innerHTML +=

      '<i class="circle" style="background:' +  getColor(categories[i]) + '"></i> ' +
          (labels[i] ? labels[i] + '<br>' : '+') ;
    }

    return div;
};

legend.addTo(map);

var legend2 = L.control({position: 'topright'});

legend2.onAdd = function (map) {

    var div = L.DomUtil.create('div', 'info legend'),
        grades = ["Last Letters", "Arrests", "Massacres"],
        labels = ["./fascistiLetter.svg","./fascistiArresto.svg","./point.svg"];

    // loop through our density intervals and generate a label with a colored square for each interval
    for (var i = 0; i < grades.length; i++) {
        div.innerHTML +=
             (" <img src="+ labels[i] +
            " width='33'>") +" "+grades[i] +'<br>';
    }

    return div;
};

legend2.addTo(map);

var currentTime = L.control({position: 'bottomright'});

map.timeDimension.on('timeload', function(data) {
    var getcurrentTime = map.timeDimension.getCurrentTime();
    var dateCurrentTime = new Date(getcurrentTime);
    var options = dateCurrentTime.toLocaleDateString();

    currentTime.onAdd = function (map){

    var div = L.DomUtil.create('div', 'yearbox');

        div.innerHTML += '<h1>' + options + '</h1> '

        return div;
    };
    currentTime.addTo(map);
});

boxInfoAdded = 0
 L.easyButton('<img src="./easy-button/info.svg" style="height:15px; width:15px; margin-top:7px ; margin-left:1px">', function(btn, map) { // Function to forward the story when clicking in the map
 // If this was the last story do the same, but show the start styry and start again.
  if (boxInfoAdded==0){
    title.addTo(map)
    boxInfoAdded=1
  } else {
    map.removeControl(title);
    boxInfoAdded=0
  }
}).addTo(map);

   </script>
</body>
</html>
